window.onload=function(){"use strict";function r(){for(var a=(b.mines_count-f).toString();a.length<3;)a="0"+a;q.innerHTML=a}function s(a,b){function f(a){for(c in b)a.style[c]=b[c]}var c,d,e=a.length;if(e)for(d=0;e>d;d++)f(a[d]);else f(a)}function t(){var k,l,a="",c=Math.floor(.6*b.cell_size),i=(b.cell_size+2)*b.column;for(clearInterval(d),f=0,r(),p.innerHTML="000",h=0,n.getElementsByTagName("span")[0].innerHTML="&#9787;",s(n,{width:i+"px"}),s(document.getElementById("container"),{width:i+"px"}),s(m,{fontSize:c+"px",lineHeight:Math.floor(100*(b.cell_size/c))+"%"}),m.classList.remove("stop"),k=0;k<b.row;k++)for(g[k]=[],l=0;l<b.column;l++)g[k][l]={info:0,open:!1,mark:0},a+='<div id="'+k+"_"+l+'" class="close">'+j[0].html+"</div>";m.innerHTML=a,s(m.querySelectorAll("div"),{width:b.cell_size+"px",height:b.cell_size+"px"}),s(m.querySelectorAll(".close"),{backgroundColor:e})}function u(a){return a[0]=parseInt(a[0],10),a[1]=parseInt(a[1],10),[[a[0]-1,a[1]-1],[a[0]-1,a[1]],[a[0]-1,a[1]+1],[a[0],a[1]-1],[a[0],a[1]+1],[a[0]+1,a[1]-1],[a[0]+1,a[1]],[a[0]+1,a[1]+1]]}function v(a){function k(){function d(a){return Math.floor(Math.random()*a)}var c;return c=[d(b.row),d(b.column)],"m"===g[c[0]][c[1]].info||c[0]===a[0]&&c[1]===a[1]?k():c}var d,f,h,i,j,c=0,e=[];a=[parseInt(a[0],10),parseInt(a[1],10)];do++c,d=k(),e.push(d),g[d[0]][d[1]].info="m";while(c<b.mines_count);for(f=0;f<e.length;f++)for(i=u(e[f]),h=0;h<i.length;h++)j=i[h],g[j[0]]&&g[j[0]][j[1]]&&"m"!==g[j[0]][j[1]].info&&g[j[0]][j[1]].info++}function w(a,b){b.open?(a.className="open",s(a,{color:i[b.info].color,backgroundColor:l}),a.innerHTML=i[b.info].html):(a.className="close",s(a,j[b.mark].css),a.innerHTML=j[b.mark].html)}function x(){clearInterval(d),m.classList.add("stop")}function y(){m.querySelectorAll(".open").length===b.row*b.column-b.mines_count&&f===b.mines_count&&(n.classList.add("rotor"),setTimeout(function(){n.classList.remove("rotor")},1e3),x())}function z(a,c,d){function h(a){var c,d,b=u(a);for(g[a[0]][a[1]].open=!0,w(document.getElementById(a.join("_")),g[a[0]][a[1]]),d=0;d<b.length;d++)if(c=b[d],g[c[0]]&&g[c[0]][c[1]]&&!g[c[0]][c[1]].open&&0===g[c[0]][c[1]].mark)switch(g[c[0]][c[1]].info){case"m":break;case 0:h(c);break;default:g[c[0]][c[1]].open=!0,w(document.getElementById(c.join("_")),g[c[0]][c[1]])}}var e,f;switch(c.info){case"m":for(c.open=!0,w(a,c),e=0;e<b.row;e++)for(f=0;f<b.column;f++)"m"===g[e][f].info&&(g[e][f].open=!0,w(document.getElementById(e+"_"+f),g[e][f]),n.getElementsByTagName("span")[0].innerHTML="&#9785;",x());break;case 0:h(d),y();break;default:c.open=!0,w(a,c),y()}}function A(){d=setInterval(function(){for(var a=Math.floor(((new Date).getTime()-c)/1e3).toString();a.length<3;)a="0"+a;999>a&&(p.innerHTML=a)},250)}var b,c,d,e,h,a={noob:{row:9,column:9,mines_count:10,cell_size:28},amateur:{row:16,column:16,mines_count:40,cell_size:28},prof:{row:16,column:40,mines_count:99,cell_size:24}},f=0,g=[],i={m:{color:"#000",html:"&bull;"},0:{color:"#ddd",html:"&nbsp;"},1:{color:"#0099CC",html:"1"},2:{color:"#669900",html:"2"},3:{color:"#CC0000",html:"3"},4:{color:"#9933CC",html:"4"},5:{color:"#FF8800",html:"5"},6:{color:"#FF8800",html:"6"},7:{color:"#FF8800",html:"7"},8:{color:"#FF8800",html:"8"}},j=[{css:{textShadow:"",color:""},html:"&nbsp;"},{css:{textShadow:"2px 2px 1px rgba(150, 150, 150, 1)",color:"#CC0000"},html:"&#9658;"}],k={green:"#C5E26D",blue:"#8AD5F0",orange:"#FFD980"},l="#ddd",m=document.getElementById("field"),n=document.getElementById("smile"),o=document.getElementById("game_type"),p=document.getElementById("timer"),q=document.getElementById("open");m.oncontextmenu=function(a){var c,d,e;return a=a||window.event,"field"!==a.target.className&&(c=a.target,d=c.id.split("_"),e=g[d[0]][d[1]],e.open||(e.mark?(e.mark=0,--f):f<b.mines_count&&(e.mark=1,++f),r(),w(c,e)),y()),!1},m.onclick=function(a){var b,d,e;a=a||window.event,"field"!==a.target.className&&(b=a.target,d=b.id.split("_"),e=g[d[0]][d[1]],++h,1===h&&(v(d),c=(new Date).getTime(),A()),e.mark||e.open||z(b,e,d))},n.getElementsByTagName("span")[0].onclick=function(){t()},o.onclick=function(c){var d;c=c||window.event,d=c.target,"a"===d.tagName.toLowerCase()&&(d.classList.contains("active")||(o.querySelector(".active").classList.remove("active"),d.classList.add("active")),b=a[d.id],t())},document.querySelector("#theme").onclick=function(a){var b;a=a||window.event,b=a.target,"a"===b.tagName.toLowerCase()&&(e=k[b.className],s(m.querySelectorAll(".close"),{backgroundColor:e}))},e=k.green,b=a.noob,t()};