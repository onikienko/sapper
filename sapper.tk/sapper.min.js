$(function(){"use strict";function r(){for(var a=(b.mines_count-f).toString();a.length<3;)a="0"+a;q.text(a)}function s(){var k,l,a="",c=Math.floor(.6*b.cell_size),i=(b.cell_size+2)*b.column;for(clearInterval(d),f=0,r(),p.text("000"),h=0,n.find("span").html("&#9787;"),n.css({width:i}),$("#container").css({width:i}),m.css({fontSize:c+"px",lineHeight:Math.floor(100*(b.cell_size/c))+"%"}).removeClass("stop"),k=0;k<b.row;k++)for(g[k]=[],l=0;l<b.column;l++)g[k][l]={info:0,open:!1,mark:0},a+='<div id="'+k+"_"+l+'" class="close">'+j[0].html+"</div>";m.html(a).find(">div").css({width:b.cell_size,height:b.cell_size}),m.find(".close").css({backgroundColor:e})}function t(a){return a[0]=parseInt(a[0],10),a[1]=parseInt(a[1],10),[[a[0]-1,a[1]-1],[a[0]-1,a[1]],[a[0]-1,a[1]+1],[a[0],a[1]-1],[a[0],a[1]+1],[a[0]+1,a[1]-1],[a[0]+1,a[1]],[a[0]+1,a[1]+1]]}function u(a){function k(){function d(a){return Math.floor(Math.random()*a)}var c;return c=[d(b.row),d(b.column)],"m"===g[c[0]][c[1]].info||c[0]===a[0]&&c[1]===a[1]?k():c}var d,f,h,i,j,c=0,e=[];a=[parseInt(a[0],10),parseInt(a[1],10)];do++c,d=k(),e.push(d),g[d[0]][d[1]].info="m";while(c<b.mines_count);for(f=0;f<e.length;f++)for(i=t(e[f]),h=0;h<i.length;h++)j=i[h],g[j[0]]&&g[j[0]][j[1]]&&"m"!==g[j[0]][j[1]].info&&g[j[0]][j[1]].info++}function v(a,b){b.open?a.attr("class","open").css({color:i[b.info].color,backgroundColor:l}).html(i[b.info].html):a.attr("class","close").css("color",j[b.mark].color).html(j[b.mark].html)}function w(){clearInterval(d),m.addClass("stop")}function x(){m.find(".open").length===b.row*b.column-b.mines_count&&f===b.mines_count&&(n.addClass("rotor"),setTimeout(function(){n.removeClass("rotor")},1e3),w())}function y(a,c,d){function h(a){var c,d,b=t(a);for(g[a[0]][a[1]].open=!0,v($("#"+a.join("_")),g[a[0]][a[1]]),d=0;d<b.length;d++)if(c=b[d],g[c[0]]&&g[c[0]][c[1]]&&!g[c[0]][c[1]].open&&0===g[c[0]][c[1]].mark)switch(g[c[0]][c[1]].info){case"m":break;case 0:h(c);break;default:g[c[0]][c[1]].open=!0,v($("#"+c.join("_")),g[c[0]][c[1]])}}var e,f;switch(c.info){case"m":for(c.open=!0,v(a,c),e=0;e<b.row;e++)for(f=0;f<b.column;f++)"m"===g[e][f].info&&(g[e][f].open=!0,v($("#"+e+"_"+f),g[e][f]),n.find("span").html("&#9785;"),w());break;case 0:h(d),x();break;default:c.open=!0,v(a,c),x()}}function z(){d=setInterval(function(){for(var a=Math.floor(((new Date).getTime()-c)/1e3).toString();a.length<3;)a="0"+a;999>a&&p.text(a)},250)}var b,c,d,e,h,a={noob:{row:9,column:9,mines_count:10,cell_size:28},amateur:{row:16,column:16,mines_count:40,cell_size:28},prof:{row:16,column:40,mines_count:99,cell_size:24}},f=0,g=[],i={m:{color:"#000",html:"&bull;"},0:{color:"#ddd",html:"&nbsp;"},1:{color:"#0099CC",html:"1"},2:{color:"#669900",html:"2"},3:{color:"#CC0000",html:"3"},4:{color:"#9933CC",html:"4"},5:{color:"#FF8800",html:"5"},6:{color:"#FF8800",html:"6"},7:{color:"#FF8800",html:"7"},8:{color:"#FF8800",html:"8"}},j=[{color:"",html:"&nbsp;"},{color:"#CC0000",html:"&#9658;"}],k={green:"#C5E26D",blue:"#8AD5F0",orange:"#FFD980"},l="#ddd",m=$("#field"),n=$("#smile"),o=$("#game_type"),p=$("#timer"),q=$("#open");m.on("mousedown",">div",function(a){var d=$(this),e=d.attr("id").split("_"),i=g[e[0]][e[1]];++h,1===h&&(u(e),c=(new Date).getTime(),z()),3===a.which?(i.open||(i.mark?(i.mark=0,--f):f<b.mines_count&&(i.mark=1,++f),r(),v(d,i)),d[0].oncontextmenu=function(){return x(),!1}):i.mark||i.open||y(d,i,e)}),n.find("span").click(function(){s()}),o.on("click","a",function(){var d=$(this);d.hasClass("active")||(o.find(".active").removeClass("active"),d.addClass("active")),b=a[d.attr("id")],s()}),$("#theme").on("click","a",function(){var a=$(this);e=k[a.attr("class")],m.find(".close").css({backgroundColor:e})}),e=k.green,b=a.noob,s()});