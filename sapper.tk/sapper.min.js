window.onload=function(){"use strict";function s(){for(var a=(k.mines_count-d).toString();a.length<3;)a="0"+a;r.innerHTML=a}function t(a,b){function f(a){for(c in b)a.style[c]=b[c]}var c,d,e=a.length;if(e)for(d=0;e>d;d++)f(a[d]);else f(a)}function u(){var i,j,a="",b=Math.floor(.6*k.cell_size),g=(k.cell_size+2)*k.column;for(clearInterval(c),d=0,s(),q.innerHTML="000",f=0,o.getElementsByTagName("span")[0].innerHTML="&#9787;",t(o,{width:g+"px"}),t(document.getElementById("container"),{width:g+"px"}),t(n,{fontSize:b+"px",lineHeight:Math.floor(100*(k.cell_size/b))+"%"}),n.classList.remove("stop"),p.querySelector(".active").classList.remove("active"),p.querySelector("#"+localStorage.game_type).className="active",i=0;i<k.row;i++)for(e[i]=[],j=0;j<k.column;j++)e[i][j]={info:0,open:!1,mark:0},a+='<div id="'+i+"_"+j+'" class="close">'+h[0].html+"</div>";n.innerHTML=a,t(n.querySelectorAll("div"),{width:k.cell_size+"px",height:k.cell_size+"px"}),t(n.querySelectorAll(".close"),{backgroundColor:l})}function v(a){return a[0]=parseInt(a[0],10),a[1]=parseInt(a[1],10),[[a[0]-1,a[1]-1],[a[0]-1,a[1]],[a[0]-1,a[1]+1],[a[0],a[1]-1],[a[0],a[1]+1],[a[0]+1,a[1]-1],[a[0]+1,a[1]],[a[0]+1,a[1]+1]]}function w(a){function j(){function c(a){return Math.floor(Math.random()*a)}var b;return b=[c(k.row),c(k.column)],"m"===e[b[0]][b[1]].info||b[0]===a[0]&&b[1]===a[1]?j():b}var c,f,g,h,i,b=0,d=[];a=[parseInt(a[0],10),parseInt(a[1],10)];do++b,c=j(),d.push(c),e[c[0]][c[1]].info="m";while(b<k.mines_count);for(f=0;f<d.length;f++)for(h=v(d[f]),g=0;g<h.length;g++)i=h[g],e[i[0]]&&e[i[0]][i[1]]&&"m"!==e[i[0]][i[1]].info&&e[i[0]][i[1]].info++}function x(a,b){b.open?(a.className="open",t(a,{color:g[b.info].color,backgroundColor:j}),a.innerHTML=g[b.info].html):(a.className="close",t(a,h[b.mark].css),a.innerHTML=h[b.mark].html)}function y(){clearInterval(c),n.classList.add("stop")}function z(){n.querySelectorAll(".open").length===k.row*k.column-k.mines_count&&d===k.mines_count&&(o.classList.add("rotor"),setTimeout(function(){o.classList.remove("rotor")},1e3),y())}function A(a,b,c){function g(a){var c,d,b=v(a);for(e[a[0]][a[1]].open=!0,x(document.getElementById(a.join("_")),e[a[0]][a[1]]),d=0;d<b.length;d++)if(c=b[d],e[c[0]]&&e[c[0]][c[1]]&&!e[c[0]][c[1]].open&&0===e[c[0]][c[1]].mark)switch(e[c[0]][c[1]].info){case"m":break;case 0:g(c);break;default:e[c[0]][c[1]].open=!0,x(document.getElementById(c.join("_")),e[c[0]][c[1]])}}var d,f;switch(b.info){case"m":for(b.open=!0,x(a,b),d=0;d<k.row;d++)for(f=0;f<k.column;f++)"m"===e[d][f].info&&(e[d][f].open=!0,x(document.getElementById(d+"_"+f),e[d][f]),o.getElementsByTagName("span")[0].innerHTML="&#9785;",y());break;case 0:g(c),z();break;default:b.open=!0,x(a,b),z()}}function B(){c=setInterval(function(){for(var a=Math.floor(((new Date).getTime()-b)/1e3).toString();a.length<3;)a="0"+a;999>a&&(q.innerHTML=a)},250)}var b,c,f,a={noob:{row:9,column:9,mines_count:10,cell_size:28},amateur:{row:16,column:16,mines_count:40,cell_size:28},prof:{row:16,column:40,mines_count:99,cell_size:24}},d=0,e=[],g={m:{color:"#000",html:"&bull;"},0:{color:"#ddd",html:"&nbsp;"},1:{color:"#0099CC",html:"1"},2:{color:"#669900",html:"2"},3:{color:"#CC0000",html:"3"},4:{color:"#9933CC",html:"4"},5:{color:"#FF8800",html:"5"},6:{color:"#FF8800",html:"6"},7:{color:"#FF8800",html:"7"},8:{color:"#FF8800",html:"8"}},h=[{css:{textShadow:"",color:""},html:"&nbsp;"},{css:{textShadow:"2px 2px 1px rgba(150, 150, 150, 1)",color:"#CC0000"},html:"&#9658;"}],i={green:"#C5E26D",blue:"#8AD5F0",orange:"#FFD980"},j="#ddd",k=function(){return localStorage.game_type=localStorage.game_type||"noob",a[localStorage.game_type]}(),l=function(){return localStorage.theme=localStorage.theme||"green",i[localStorage.theme]}(),n=document.getElementById("field"),o=document.getElementById("smile"),p=document.getElementById("game_type"),q=document.getElementById("timer"),r=document.getElementById("open");n.oncontextmenu=function(a){var b,c,f;return a=a||window.event,"field"!==a.target.className&&(b=a.target,c=b.id.split("_"),f=e[c[0]][c[1]],f.open||(f.mark?(f.mark=0,--d):d<k.mines_count&&(f.mark=1,++d),s(),x(b,f)),z()),!1},n.onclick=function(a){var c,d,g;a=a||window.event,"field"!==a.target.className&&(c=a.target,d=c.id.split("_"),g=e[d[0]][d[1]],++f,1===f&&(w(d),b=(new Date).getTime(),B()),g.mark||g.open||A(c,g,d))},o.getElementsByTagName("span")[0].onclick=function(){u()},p.onclick=function(b){var c;b=b||window.event,c=b.target,"a"===c.tagName.toLowerCase()&&(c.classList.contains("active")||(p.querySelector(".active").classList.remove("active"),c.classList.add("active")),localStorage.game_type=c.id,k=a[c.id],u())},document.querySelector("#theme").onclick=function(a){var b;a=a||window.event,b=a.target,"a"===b.tagName.toLowerCase()&&(localStorage.theme=b.className,l=i[b.className],t(n.querySelectorAll(".close"),{backgroundColor:l}))},u()};